name: 'cargo run'

on:
  workflow_call:
    inputs:
      toolchain-version:
        required: false
        type: string
        default: stable
      working-directory:
        required: false
        type: string
        default: '.'
      pre-command:
        required: false
        type: string
        default: ''
      pre-args:
        required: false
        type: string
        default: ''
      command:
        required: true
        type: string
      args:
        required: false
        type: string
        default: ''
      post-command:
        required: false
        type: string
        default: ''
      post-args:
        required: false
        type: string
        default: ''

permissions:
  contents: 'read'

jobs:
  run:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@2541b1294d2704b0964813337f33b291d3f8596b # v3.0.2

      - name: Setup Toolchain
        uses: actions-rs/toolchain@16499b5e05bf2e26879000db0c1d13f7e13fa3af # v1.0.7
        with:
          toolchain: '${{ inputs.toolchain-version }}'

      - name: Run Pre-Command
        if: inputs.pre-command != ''
        uses: actions-rs/cargo@844f36862e911db73fe0815f00a4a2602c279505 # v1.0.3
        with:
          command: '${{ inputs.pre-command }}'
          args: '${{ inputs.pre-args }}'

      - name: Run Command
        uses: actions-rs/cargo@844f36862e911db73fe0815f00a4a2602c279505 # v1.0.3
        with:
          command: '${{ inputs.command }}'
          args: '${{ inputs.args }}'

      - name: Run Post-Command
        if: inputs.post-command != ''
        uses: actions-rs/cargo@844f36862e911db73fe0815f00a4a2602c279505 # v1.0.3
        with:
          command: '${{ inputs.post-command }}'
          args: '${{ inputs.post-args }}'
